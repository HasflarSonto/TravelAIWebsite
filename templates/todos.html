{% extends "base.html" %}

{% block content %}
<div class="page-layout">
    <div class="left-column">
        <h1 class="itinerary-title">Trip Planning Checklist</h1>
        <a href="{{ url_for('show_itinerary') }}" class="back-btn">← Back to Itinerary</a>
    </div>
    
    <div class="right-column">
        {% for day in trip_events %}
        <h2 class="day-header">Day {{ loop.index }} - {{ day.date }}</h2>
        {% for activity in day.activities %}
        <div class="activity-row">
            <div class="time-block">{{ activity.start_time }} to {{ activity.end_time }}</div>
            <div class="activity-title">
                {{ activity.title }}
                <div class="event-confirmed">
                    <span>Event Confirmed</span>
                    <input type="checkbox" class="event-checkbox" {% if activity.confirmed %}checked{% endif %}>
                </div>
            </div>
            <div class="location">{{ activity.location }}</div>
            <button class="toggle-todos-btn" onclick="toggleTodos(this)">▼</button>
            <div class="todo-items" data-activity-id="{{ activity.id }}" data-todos="{{ activity.todos|tojson|safe if activity.todos else '[]' }}">
                {% for todo in activity.todos %}
                <div class="todo-item">
                    <span class="todo-label">{{ todo.text }}</span>
                    <input type="checkbox" class="todo-checkbox" {% if todo.completed %}checked{% endif %}>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        {% endfor %}
    </div>
</div>

<style>
/* Add new animations */
@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes floatingLight {
    0% { transform: translate(-100%, -50%) scale(1); opacity: 0; }
    50% { transform: translate(50%, 25%) scale(1.2); opacity: 0.3; }
    100% { transform: translate(200%, 100%) scale(1); opacity: 0; }
}

/* Update existing styles with animations */
.page-layout {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    display: flex;
    gap: 40px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, 
        rgba(135, 150, 207, 0.1) 0%, 
        rgba(91, 106, 150, 0.1) 50%, 
        rgba(135, 150, 207, 0.1) 100%
    );
    background-size: 200% 200%;
    animation: gradientShift 15s ease infinite;
}

/* Add floating light effect */
.page-layout::before {
    content: '';
    position: absolute;
    width: 200px;
    height: 200px;
    background: radial-gradient(circle, rgba(135, 150, 207, 0.2) 0%, transparent 70%);
    animation: floatingLight 12s ease-in-out infinite;
    pointer-events: none;
}

.left-column {
    width: 300px;
}

.right-column {
    flex: 1;
}

.itinerary-title {
    color: #8796cf;
    font-size: 2.5em;
    margin-bottom: 20px;
}

.back-btn {
    color: #8796cf;
    text-decoration: none;
    font-size: 1.1em;
}

.day-header {
    color: #8796cf;
    font-size: 1.8em;
    margin: 40px 0 20px 0;
    transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateY(20px);
}

.day-header.visible {
    opacity: 1;
    transform: translateY(0);
}

.activity-row {
    background: rgba(22, 28, 28, 0.7);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(135, 150, 207, 0.2);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateY(20px);
    padding: 20px;
    margin-bottom: 20px;
}

.activity-row.visible {
    opacity: 1;
    transform: translateY(0);
}

.activity-row:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(135, 150, 207, 0.15);
    background: rgba(22, 28, 28, 0.8);
}

.time-block {
    color: #8796cf;
    font-size: 0.9em;
    margin-bottom: 10px;
}

.activity-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #8796cf;
    font-size: 1.2em;
    margin-bottom: 10px;
}

.event-confirmed {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #6b7a9a;
    font-size: 0.9em;
}

.location {
    color: #6b7a9a;
    margin-bottom: 15px;
}

.todo-items {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.todo-items.active {
    max-height: 1000px; /* or adjust based on your content */
    opacity: 1;
}

.todo-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 16px;
    background: rgba(135, 150, 207, 0.1);
    border-radius: 4px;
    margin: 8px 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateY(10px);
}

.todo-item.visible {
    opacity: 1;
    transform: translateY(0);
}

.todo-item:hover {
    transform: translateX(5px);
    background: rgba(135, 150, 207, 0.2);
}

.todo-label {
    color: #6b7a9a;
}

.todo-checkbox {
    cursor: pointer;
}

.event-checkbox {
    cursor: pointer;
}

.toggle-todos-btn {
    background: transparent;
    border: 1px solid #8796cf;
    color: #8796cf;
    padding: 4px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1em;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: block;
    margin: 10px 0;
    width: 40px;
}

.toggle-todos-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(135, 150, 207, 0.2);
    background: rgba(135, 150, 207, 0.2);
}

.toggle-todos-btn.active {
    transform: rotate(180deg);
    background: rgba(135, 150, 207, 0.2);
}

.activity-controls {
    display: flex;
    align-items: center;
    gap: 15px;
}
</style>

<script src="{{ url_for('static', filename='todos.js') }}"></script>

<script>
// Add to existing script or create new script section
document.addEventListener('DOMContentLoaded', function() {
    // Intersection Observer for scroll animations
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                
                // Animate todo items if they exist
                if (entry.target.classList.contains('activity-row')) {
                    const todoItems = entry.target.querySelectorAll('.todo-item');
                    todoItems.forEach((item, index) => {
                        setTimeout(() => {
                            item.classList.add('visible');
                        }, index * 100);
                    });
                }
            }
        });
    }, {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    });

    // Observe elements for animation
    document.querySelectorAll('.activity-row, .day-header').forEach(el => {
        observer.observe(el);
    });

    // Add smooth scroll behavior
    document.documentElement.style.scrollBehavior = 'smooth';
});

// Update the toggleTodos function
function toggleTodos(button) {
    button.classList.toggle('active');
    const todoItems = button.nextElementSibling;
    todoItems.classList.toggle('active');
    
    if (todoItems.classList.contains('active')) {
        todoItems.style.maxHeight = todoItems.scrollHeight + 'px';
        todoItems.style.opacity = '1';
    } else {
        todoItems.style.maxHeight = '0';
        todoItems.style.opacity = '0';
    }
}
</script>
{% endblock %} 